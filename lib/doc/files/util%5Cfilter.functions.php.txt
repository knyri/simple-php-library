<?php
/**
 * @package util
 */


/**
 * Strips magic quotes if enabled
 * @param string $var
 * @return string
 */
function filter_mq($var){
	if(get_magic_quotes_gpc())
		return stripcslashes($var);
	return $var;
}
/**
 * @param string $var
 * @param string $nl2br (false)
 * @return string
 * @deprecated
 */
function filter_special($var,$nl2br = false){
	if (is_array($var)) {
		foreach ($var as $key=>$value) {
			$var[$key] = filter_special($value);
		}
		return $var;
	}
	$chars = array(
		128=>'�',
		130=>'�',
		131=>'�',
		132=>'�',
		133=>'�',
		134=>'�',
		135=>'�',
		136=>'�',
		137=>'�',
		138=>'�',
		139=>'�',
		140=>'�',
		142=>'�',
		145=>'�',
		146=>'�',
		147=>'�',
		148=>'�',
		149=>'�',
		150=>'�',
		151=>'�',
		152=>'�',
		153=>'�',
		154=>'�',
		155=>'�',
		156=>'�',
		158=>'�',
		159=>'�');
	$var = str_replace(array_map('chr', array_keys($chars)), $chars, $var);
	if($nl2br){
		return nl2br($var);
	} else {
		return $var;
	}
}
/**
 * Replaces special characters like smart quotes with their equivalent
 * @param string $var
 * @param string $charset (utf-8)
 * @param string $htmlent (true) replace with HTML entities
 * @return string
 */
function filter_msword($var,$charset='utf-8',$htmlent=true) {
	static $chars=null;
	$charset=strtolower($charset);
	if (is_array($var)) {
		foreach ($var as $key=>$value) {
			$var[$key] = filter_msword($value,$charset);
		}
		return $var;
	}
	if($chars==null){
		$chars = array(
			'utf-8'=>array(
				"\xe2\x80\x90"=>'-',
				"\xe2\x80\x91"=>'-',
				"\xe2\x80\x92"=>'-',
				"\xe2\x80\x93"=>'-',
				"\xe2\x80\x94"=>'--',
				"\xe2\x80\x95"=>'--',
				"\xe2\x80\x96"=>'||',
				"\xe2\x80\x97"=>'_',
				"\xe2\x80\x98"=>'\'',
				"\xe2\x80\x99"=>'\'',
				"\xe2\x80\x9a"=>'&sbquo;',
				"\xe2\x80\x9b"=>'\'',
				"\xe2\x80\xc2"=>'&prime;',
				"\xe2\x80\xc3"=>'&Prime;',
				"\xe2\x80\x9c"=>'"',
				"\xe2\x80\x9d"=>'"',
				"\xe2\x80\x9f"=>'"',
				"\xe2\x80\xa2"=>'&bull;',
				"\xe2\x80\x93"=>'&ndash;',
				"\xe2\x80\x94"=>'&mdash;',
				"\xe2\x80\xb9"=>'&lsquo;',
				"\xe2\x80\xba"=>'&rsquo;',
				"\xe2\x80\xa6"=>'&hellip;',
				"\xe2\x84\xa2"=>'&trade;',
				"\xc2\xa0"=>"&nbsp;",
				"\xc2\xa1"=>'&iexcl;',
				"\xc2\xa2"=>'&cent;',
				"\xc2\xa3"=>'&pound;',
				"\xc2\xa4"=>'&curren;',
				"\xc2\xa5"=>'&yen;',
				"\xc2\xa6"=>'&brvbar;',
				"\xc2\xa7"=>'&sect;',
				"\xc2\xa8"=>'&uml;',
				"\xc2\xa9"=>'&copy;',
				"\xc2\xaa"=>'&ordf;',
				"\xc2\xab"=>'&laquo;',
				"\xc2\xac"=>'&not;',
				"\xc2\xad"=>" ",//soft hyphen
				"\xc2\xae"=>'&reg;',
				"\xc2\xaf"=>'&macr;',
				"\xc2\xb0"=>'&deg;',
				"\xc2\xb1"=>'&plusmn;',
				"\xc2\xb2"=>'&sup2;',
				"\xc2\xb3"=>'&sup3;',
				"\xc2\xb4"=>'&acute;',
				"\xc2\xb5"=>'&micro;',
				"\xc2\xb6"=>'&para;',
				"\xc2\xb7"=>'&middot;',
				"\xc2\xb8"=>'&cedil;',
				"\xc2\xb9"=>'&sup1;',
				"\xc2\xba"=>'&ordm;',
				"\xc2\xbb"=>'&raquo;',
				"\xc2\xbc"=>'&frac14;',
				"\xc2\xbd"=>'&frac12;',
				"\xc2\xbe"=>'&frac34;',
				"\xc2\xbf"=>'&iquest;',
				"\xc3\x80"=>"&Agrave;",
				"\xc3\x81"=>"&Aacute;",
				"\xc3\x82"=>"&Acirc;",
				"\xc3\x83"=>"&Atilde;",
				"\xc3\x84"=>"&Auml;",
				"\xc3\x85"=>"&Aring;",
				"\xc3\x86"=>"&AElig;",
				"\xc3\x87"=>"&Ccedil;",
				"\xc3\x88"=>"&Egrave;",
				"\xc3\x89"=>"&Eacute;",
				"\xc3\x8a"=>"&Ecirc;",
				"\xc3\x8b"=>"&Euml;",
				"\xc3\x8c"=>"&Igrave;",
				"\xc3\x8d"=>"&Iacute;",
				"\xc3\x8e"=>"&Icirc;",
				"\xc3\x8f"=>"&Iuml;",
				"\xc3\x90"=>"&ETH;",
				"\xc3\x91"=>"&Ntilde;",
				"\xc3\x92"=>"&Ograve;",
				"\xc3\x93"=>"&Oacute;",
				"\xc3\x94"=>"&Ocirc;",
				"\xc3\x95"=>"&Otilde;",
				"\xc3\x96"=>"&Ouml;",
				"\xc3\x97"=>'&times;',
				"\xc3\x98"=>"&Oslash;",
				"\xc3\x99"=>"&Ugrave;",
				"\xc3\x9a"=>"&Uacute;",
				"\xc3\x9b"=>"&Ucirc;",
				"\xc3\x9c"=>"&Uuml;",
				"\xc3\x9d"=>"&Yacute;",
				"\xc3\x9e"=>"&THORN;",
				"\xc3\x9f"=>"&szlig;",
				"\xc3\xa0"=>"&agrave;",
				"\xc3\xa1"=>"&aacute;",
				"\xc3\xa2"=>"&acirc;",
				"\xc3\xa3"=>"&atilde;",
				"\xc3\xa4"=>"&auml;",
				"\xc3\xa5"=>"&aring;",
				"\xc3\xa6"=>"&aelig;",
				"\xc3\xa7"=>"&ccedil;",
				"\xc3\xa8"=>"&egrave;",
				"\xc3\xa9"=>"&eacute;",
				"\xc3\xaa"=>"&ecirc;",
				"\xc3\xab"=>"&euml;",
				"\xc3\xac"=>"&igrave;",
				"\xc3\xad"=>"&iacute;",
				"\xc3\xae"=>"&icirc;",
				"\xc3\xaf"=>"&iuml;",
				"\xc3\xb0"=>"&eth;",
				"\xc3\xb1"=>"&ntilde;",
				"\xc3\xb2"=>"&ograve;",
				"\xc3\xb3"=>"&oacute;",
				"\xc3\xb4"=>"&ocirc;",
				"\xc3\xb5"=>"&otilde;",
				"\xc3\xb6"=>"&ouml;",
				"\xc3\xb7"=>'&divide;',
				"\xc3\xb8"=>"&oslash;",
				"\xc3\xb9"=>"&ugrave;",
				"\xc3\xba"=>"&uacute;",
				"\xc3\xbb"=>"&ucirc;",
				"\xc3\xbc"=>"&uuml;",
				"\xc3\xbd"=>"&yacute;",
				"\xc3\xbe"=>"&thorn;",
				"\xc3\xbf"=>"&yuml;",
				"\xc5\x92"=>"&OElig;",
				"\xc5\x93"=>"&oelig;",
				"\xce\x91"=>"&Alpha;",
				"\xce\x92"=>"&Beta;",
				"\xce\x93"=>"&Gamma;",
				"\xce\x94"=>"&Delta;",
				"\xce\x95"=>"&Epsilon;",
				"\xce\x96"=>"&Zeta;",
				"\xce\x97"=>"&Eta;",
				"\xce\x98"=>"&Theta;",
				"\xce\x99"=>"&Iota;",
				"\xce\x9a"=>"&Kappa;",
				"\xce\x9b"=>"&Lambda;",
				"\xce\x9c"=>"&Mu;",
				"\xce\x9d"=>"&Nu;",
				"\xce\x9e"=>"&Xi;",
				"\xce\x9f"=>"&Omicron;",
				"\xce\xa0"=>"&Pi;",
				"\xce\xa1"=>"&Rho;",
				"\xce\xa3"=>"&Sigma;",
				"\xce\xa4"=>"&Tau;",
				"\xce\xa5"=>"&Upsilon;",
				"\xce\xa6"=>"&Phi;",
				"\xce\xa7"=>"&Chi;",
				"\xce\xa8"=>"&Psi;",
				"\xce\xa9"=>"&Omega;",
				"\xce\xb1"=>"&alpha;",
				"\xce\xb2"=>"&beta;",
				"\xce\xb3"=>"&gamma;",
				"\xce\xb4"=>"&delta;",
				"\xce\xb5"=>"&epsilon;",
				"\xce\xb6"=>"&zeta;",
				"\xce\xb7"=>"&eta;",
				"\xce\xb8"=>"&theta;",
				"\xce\xb9"=>"&iota;",
				"\xce\xba"=>"&kappa;",
				"\xce\xbb"=>"&lambda;",
				"\xce\xbc"=>"&mu;",
				"\xce\xbd"=>"&nu;",
				"\xce\xbe"=>"&xi;",
				"\xce\xbf"=>"&omicron;",
				"\xcf\x80"=>"&pi;",
				"\xcf\x81"=>"&rho;",
				"\xcf\x82"=>"&sigmaf;",
				"\xcf\x83"=>"&sigma;",
				"\xcf\x84"=>"&tau;",
				"\xcf\x85"=>"&upsilon;",
				"\xcf\x86"=>"&phi;",
				"\xcf\x87"=>"&chi;",
				"\xcf\x88"=>"&psi;",
				"\xcf\x89"=>"&omega;",
				//malformed
				"\x00\xa9"=>'&copy;',
				"\x00\xae"=>'&reg;',
				"\x00\xb2"=>'&sup2;',
				"\x00\xb3"=>'&sup3;',
				"\x00\xb4"=>'&acute;',
				"\x00\xb7"=>'&middot;',
				"\x00\xb9"=>'&sup1;',
				"\x00\xbc"=>'&frac14;',
				"\x00\xbd"=>'&frac12;',
				"\x00\xbe"=>'&frac34;',
				"\x00\x18"=>'\'',
				"\x18\x20"=>'\'',
				"\x00\x19"=>'\'',
				"\x19\x20"=>'\'',
				"\x00\x1c"=>'"',
				"\x1c\x20"=>'"',
				"\x00\x1d"=>'"',
				"\x1d\x20"=>'"',
				"\x00\x22"=>'&bull;',
				"\x00\x13"=>'&ndash;',
				"\x00\x14"=>'&mdash;',
				"\x00\x26"=>'&hellip;',
			),
			'windows-1252'=>array(
				"\xa0"=>' ',
				"\xa1"=>'&iexcl;',
				"\xa2"=>'&cent;',
				"\xa3"=>'&pound;',
				"\xa4"=>'&curren;',
				"\xa5"=>'&yen;',
				"\xa6"=>'&brvbar;',
				"\xa7"=>'&sect;',
				"\xa8"=>'&uml;',
				"\xa9"=>'&copy;',
				"\xaa"=>'&ordf;',
				"\xab"=>'&laquo;',
				"\xac"=>'&not;',
				"\xae"=>'&reg;',
				"\xaf"=>'&macr;',
				"\xb0"=>'&deg;',
				"\xb1"=>'&plusmn;',
				"\xb2"=>'&sup2;',
				"\xb3"=>'&sup3;',
				"\xb4"=>'&acute;',
				"\xb6"=>'&para;',
				"\xb7"=>'&middot;',
				"\xb8"=>'&cedil;',
				"\xb9"=>'&sup1;',
				"\xba"=>'&ordm;',
				"\xbb"=>'&raquo;',
				"\xbc"=>'&frac14;',
				"\xbd"=>'&frac12;',
				"\xbe"=>'&frac34;',
				"\xbf"=>'&iquest;',
				"\xd7"=>'&times;',
				"\xf7"=>'&divide;',
				"\x80"=>'&euro;',
				"\x82"=>'&sbquo;',
				"\x83"=>'&fnot;',
				"\x84"=>'&bdquo;',
				"\x85"=>'&hellip;',
				"\x86"=>'&dagger;',
				"\x87"=>'&Dagger;',
				"\x88"=>'&circ;',
				"\x89"=>'&permil;',
				"\x8a"=>'&Scaron;',
				"\x8b"=>'&lsaquo;',
				"\x8c"=>'&OElig;',
				"\x8e"=>'&#142;',
				"\x91"=>'\'',
				"\x92"=>'\'',
				"\x95"=>'&bull;',
				"\x96"=>'&ndash;',
				"\x97"=>'&mdash;',
				"\x99"=>'&trade;',
				"\x9a"=>'&scaron;',
				"\x9b"=>'&rsaquo;',
				"\x9c"=>'&oelig;',
				"\x9e"=>'&#158;',
				"\x9f"=>'&Yuml;',
			),/*
			,
			'windows-1252'=>array(
				"\x00"=>'&iexcl;',
				"\x00"=>'&cent;',
				"\x00"=>'&pound;',
				"\x00"=>'&curren;',
				"\x00"=>'&yen;',
				"\x00"=>'&brvbar;',
				"\x00"=>'&sect;',
				"\x00"=>'&uml;',
				"\x00"=>'&copy;',
				"\x00"=>'&ordf;',
				"\x00"=>'&laquo;',
				"\x00"=>'&not;',
				"\x00"=>'&reg;',
				"\x00"=>'&macr;',
				"\x00"=>'&deg;',
				"\x00"=>'&plusmn;',
				"\x00"=>'&sup2;',
				"\x00"=>'&sup3;',
				"\x00"=>'&acute;',
				"\x00"=>'&micro;',
				"\x00"=>'&para;',
				"\x00"=>'&middot;',
				"\x00"=>'&cedil;',
				"\x00"=>'&sup1;',
				"\x00"=>'&ordm;',
				"\x00"=>'&raquo;',
				"\x00"=>'&frac14;',
				"\x00"=>'&frac12;',
				"\x00"=>'&frac34;',
				"\x00"=>'&iquest;',
				"\x00"=>'&times;',
				"\x00"=>'&divide;',
				"\x20"=>'&sbquo;',
				"\x00"=>'&circ;',
				"\x20"=>"\'',
				"\x20"=>"\'',
				"\x20"=>'"',
				"\x20"=>'"',
				"\x20"=>'&bull;',
				"\x20"=>'&ndash;',
				"\x20"=>'&mdash;',
				"\x20"=>'&hellip;',
			)
			*/
		);
		$chars['cp1252']=&$chars['windows-1252'];
		//I realise that there are minor differences between these two.
		$chars['iso-8859-1']=&$chars['windows-1252'];

	}
	$var = strtr($var, $chars[$charset]);
	if(!$htmlent){
		$var=strtr($var,array("\xa1"=>'&iexcl;',
				'&copy;'=>'(c)',
				'&trade;'=>'(tm)',
				'&reg;'=>'(r)',
				'&laquo;'=>'<<',
				'&sup2;'=>'^2',
				'&sup3;'=>'^3',
				'&raquo;'=>'>>',
				'&frac14;'=>'1/4',
				'&frac12;'=>'1/2',
				'&frac34;'=>'3/4',
				'&iquest;'=>'?',
				'&times;'=>'*',
				'&divide;'=>'/',
				'&cent;'=>' cents',
				'&pound;'=>' Pounds',
				'&yen;'=>' Yen',
				'&euro;'=>'Euro',
				'&sect;'=>'section ',
				'&sbquo;'=>'\'',
				'&bdquo;'=>'"',
				'&hellip;'=>'...',
				'&lsaquo;'=>'<',
				'&bull;'=>'*',
				'&ndash;'=>'-',
				'&mdash;'=>'--',
				'&rsaquo;'=>'>',
			));
	}
	return $var;
}
function filter_rem_url_reserved($str){
	$str=str_replace(array(':','/',',',';','<','>','?','\\',')','(','*','&','^','%','$','#','@','!','`','~','\'','"','[',']','{','}','|','_','=','+'),'',$str);
	return str_replace(' ','-',$str);
}
